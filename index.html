<html>
    <head>
        <meta charset="utf-8" />
        <style>
          #scenario {
            height: 90%;
            width: 90%;
            overflow-x: scroll;
            writing-mode: vertical-rl;
            text-orientation: upright;
            background-color:cadetblue;
          }
          #number {
            writing-mode: horizontal-tb;
          }
        </style>
        
        <title>素晴らしいアンダーザシー</title>
    </head>

<body>
    <form id="form1" action="#">
        <textarea name="kanso" id="input_message" rows="4" cols="40">ここに感想を記入してください。</textarea>
        <input type="button" onclick="func1()" value="5億円払う">
    </form>

    <div id="scenario"></div>

    <script language="javascript" type="text/javascript">
        function func1() {
            var strs = document.getElementById("input_message").value.split("\n");

            var selif_start_char = "「"
            var selif_end_char = "」"

            var analyzed_scenario_data = new Array();

            //this.push(["CHARACTOR_NAME","SELIF"])

            var in_parentheses = false;
            var character_name = "";
            var selif = "";
            var input_message = ""
            for(var i = 0;i < strs.length;i++){
                s = strs[i]
                if((s.indexOf(selif_start_char) != -1) & (!in_parentheses)){
                    character_name = s.substr(0,s.indexOf(selif_start_char))
                    if(s.indexOf(selif_end_char) != -1){
                        selif = s.substr(s.indexOf(selif_start_char),s.indexOf(selif_end_char))
                        analyzed_scenario_data.push([character_name,selif]);
                    }else{
                        selif = s.substr(s.indexOf(selif_start_char),s.length);
                        in_parentheses = true;
                    }
                    continue;
                }
                if(s.indexOf(selif_end_char) != -1){
                    selif = selif + s.substr(0,s.indexOf(selif_end_char));
                    analyzed_scenario_data.push([character_name,selif]);
                    in_parentheses = false;
                    continue;
                }else{
                    selif = selif + s;
                }
            }

            input_message = '<table border="1" cellspacing="0" cellpadding="5" bordercolor="#333333"><tr>'+
                '<th height = "20" bgcolor="#EE0000"><font color="#FFFFFF">番号</font></th>'+
                '<th height = "100" bgcolor="#EE0000"><font color="#FFFFFF">キャラ名</font></th>'+
                '<th bgcolor="#EE0000" ><font color="#FFFFFF">セリフ</font></th></tr>';


            for(var i = 0;i < analyzed_scenario_data.length;i++){
                number = "00000".substr(0,3 - i.toString().length) + i.toString()
                name = analyzed_scenario_data[i][0]
                selif = analyzed_scenario_data[i][1]

                push_str = '<td class ="number"  width = 60 >' + number + "</td><td>" + name + "</td><td>" + selif + "</td></tr>"
                input_message = input_message + push_str
            }
            input_message = input_message + "</table>"

            document.getElementById("scenario").innerHTML = input_message;
        }
    </script>
</body>
</html>